---
name: plan
description: Collaborative feature planning with all agents. Creates comprehensive specification with input from @Architect, @Product, @DevOps, @Dev, and @QA.
---

You are facilitating a collaborative planning session.

# Workflow

When invoked with `/plan [feature]`:

## Phase 1: Gathering Input

### @Product Contribution
- Define business value and user impact
- Create user stories with Gherkin criteria
- Prioritize requirements

### @Architect Contribution
- Propose technical approach
- Identify architectural impacts
- Suggest design patterns

### @DevOps Contribution
- Identify infrastructure needs
- Plan deployment strategy
- Consider scalability requirements

### @Dev Contribution
- Estimate implementation effort
- Identify technical challenges
- Suggest implementation approach

### @QA Contribution
- Define test strategy
- Identify test scenarios
- Plan test data requirements

## Phase 2: Create Planning Document

Generate comprehensive plan:

```markdown
# Feature Planning: [Feature Name]

## Business Context
**Stakeholder:** [Who requested]
**Business Value:** [Why we're building this]
**Success Metrics:** [How we measure success]

## Product Specification (@Product)

### User Stories
[List of user stories with Gherkin criteria]

### Requirements
- [Functional requirement 1]
- [Non-functional requirement 1]

## Technical Architecture (@Architect)

### Approach
[High-level technical approach]

### Architecture Diagram
```mermaid
[Mermaid diagram]
```

### Design Decisions
- [Decision 1 with rationale]
- [Decision 2 with rationale]

### Affected Components
- [Component 1]
- [Component 2]

## Infrastructure Requirements (@DevOps)

### Environment Changes
- [Change 1]
- [Change 2]

### Deployment Strategy
[How this will be deployed]

### Monitoring
[What we'll monitor]

## Implementation Plan (@Dev)

### Tasks Breakdown
1. [Task 1] - [Estimate]
2. [Task 2] - [Estimate]

### Technical Challenges
- [Challenge 1 and mitigation]
- [Challenge 2 and mitigation]

### Dependencies
- [External dependency 1]
- [Internal dependency 1]

## Test Strategy (@QA)

### Test Scenarios
- [Scenario 1]
- [Scenario 2]

### Coverage Goals
- Unit: [target]%
- Integration: [target]%

### Test Data
[Test data requirements]

## Timeline

| Phase | Duration | Owner |
|-------|----------|-------|
| Architecture | [time] | @Architect |
| Implementation | [time] | @Dev |
| Testing | [time] | @QA |
| Deployment | [time] | @DevOps |

**Total Estimate:** [total time]

## Risks and Mitigations

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| [Risk 1] | High | Medium | [Mitigation plan] |

## Decision Points

- [ ] Architecture approved
- [ ] Infrastructure requirements confirmed
- [ ] Timeline accepted
- [ ] Resources allocated

---
> *Generated by Claude Code - Collaborative Planning Session*
```

## Phase 3: Create Issues

After user approval, create:
1. Epic issue (if needed)
2. Implementation issues
3. Testing issues
4. Documentation issues

## Phase 4: Show Summary

Present to user:
- **Issues Created:** [list]
- **Total Estimate:** [time]
- **Next Steps:** [action items]

# Important Notes

- Get input from ALL relevant agents
- Show complete plan BEFORE creating issues
- Wait for user approval
- Only create issues after approval

# Example Usage

```
/plan Add two-factor authentication to login
```

This will orchestrate:
1. @Product defines user stories
2. @Architect designs the solution
3. @DevOps plans infrastructure
4. @Dev estimates implementation
5. @QA plans testing
6. Generate comprehensive plan
7. Create issues after approval
